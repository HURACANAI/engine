# RunPod-specific configuration
# This config is optimized for RunPod deployment

scheduler:
  daily_run_time_utc: "02:00"
  timezone: "UTC"

universe:
  target_size: 3  # Top 3 coins for testing (BTC, ETH, SOL typically)
  liquidity_threshold_adv_gbp: 10000000
  max_spread_bps: 8

training:
  window_days: 150
  walk_forward:
    train_days: 20
    test_days: 5
    min_trades: 300
  model_training:
    n_estimators: 2000  # Increased from 300 for proper intensive training
    learning_rate: 0.01  # Lower learning rate for better learning
    max_depth: 8  # Increased depth for more complex patterns
    subsample: 0.8
    colsample_bytree: 0.8
    min_child_samples: 32
    early_stopping_rounds: 100  # Enable early stopping
    verbose: -1  # Suppress verbose output
    n_jobs: -1  # Use all CPU cores
    random_state: 42
  advanced:
    use_multi_model_ensemble: true  # Use ensemble of multiple models
    ensemble_techniques: ["xgboost", "random_forest", "lightgbm"]
    ensemble_method: "weighted_voting"  # "weighted_voting", "stacking", "dynamic"
    use_progressive_training: false  # Disable for now (takes very long)
    progressive_initial_epoch_days: 730  # 2 years for first epoch
    progressive_subsequent_epoch_days: 365  # 1 year for subsequent epochs
    progressive_max_epochs: null  # null = train until inception
    use_enhanced_rl: true  # Use enhanced RL pipeline with Phase 1 features
    use_rl_v2_pipeline: true  # Use V2 pipeline (triple-barrier, meta-labeling)
    enable_advanced_rewards: true  # Advanced reward shaping
    enable_higher_order_features: true  # Higher-order feature engineering
    enable_granger_causality: true  # Granger causality for cross-asset timing
    enable_regime_prediction: true  # Regime transition prediction
    use_meta_labeling: true  # Meta-labeling for profitable trades
    meta_label_cost_threshold: 0.0  # Cost threshold for meta-labeling
    use_triple_barrier: true  # Triple-barrier labeling (no lookahead bias)
    use_recency_weighting: true  # Weight recent data higher
    use_v2_data_quality: true  # V2 data quality pipeline
  rl_agent:
    enabled: true
    learning_rate: 0.0003
    gamma: 0.99
    clip_epsilon: 0.2
    entropy_coef: 0.01
    n_epochs: 10
    epochs_per_update: 10  # More epochs per update for better learning
    batch_size: 128  # Increased for GPU
    state_dim: 80
    device: "cuda"  # Use GPU on RunPod
  shadow_trading:
    enabled: true
    position_size_gbp: 1000
    max_hold_minutes: 120
    stop_loss_bps: 15
    take_profit_bps: 20
    min_confidence_threshold: 0.52
  memory:
    vector_similarity_threshold: 0.7
    min_pattern_occurrences: 10
    pattern_update_frequency: "daily"
    max_similar_patterns: 20
  monitoring:
    enabled: true
    check_interval_seconds: 300
    win_rate_stddev_threshold: 2.0
    profit_stddev_threshold: 2.0
    volume_stddev_threshold: 2.5
    auto_remediation_enabled: true
    pause_failing_patterns: true
    pattern_failure_threshold: 0.45
  validation:
    enabled: true
    mandatory_oos:
      enabled: true
      min_oos_sharpe: 1.0
      min_oos_win_rate: 0.55
      max_train_test_gap: 0.3
      max_sharpe_std: 0.2
      min_test_trades: 100
      min_windows: 5
    overfitting_detection:
      enabled: true
      train_test_gap_threshold: 0.5
      cv_stability_threshold: 0.3
      degradation_threshold: -0.2
    data_validation:
      enabled: true
      outlier_z_threshold: 3.0
      max_missing_pct: 0.05
      max_age_hours: 24
      min_coverage: 0.95
    paper_trading:
      enabled: false
      min_duration_days: 14
      min_trades: 100
      min_win_rate: 0.55
      min_sharpe: 1.0
      max_backtest_deviation: 0.20
    stress_testing:
      enabled: false
      max_drawdown_threshold: 0.30
      min_survival_rate: 0.70
  optimization:
    parallel_processing:
      enabled: true
      num_workers: 8  # Adjust based on CPU cores (nproc / 2)
      use_ray: true
    caching:
      enabled: true
      max_size: 2000  # Increased for RunPod
      default_ttl: 3600
    query_optimization:
      enabled: true
      enable_caching: true
      cache_ttl: 3600

costs:
  target_net_bps: 15
  taker_buffer_bps: 9
  notional_per_trade: 1000

artifacts:
  bucket: huracan-engine
  prefix: baselines

postgres:
  # Update with your RunPod PostgreSQL credentials
  dsn: "postgresql://haq:huracan123@localhost:5432/huracan"

notifications:
  telegram_enabled: true
  telegram_webhook_url: "https://api.telegram.org/bot8229109041:AAFIcLRx3V50khoaEIG7WXeI1ITzy4s6hf0/sendMessage"
  telegram_chat_id: "7914196017"  # Your Telegram user ID

ray:
  address: null  # Local Ray cluster (no remote address)
  namespace: "huracan-engine"
  runtime_env:
    working_dir: "/workspace/engine"  # Update to your RunPod working directory

